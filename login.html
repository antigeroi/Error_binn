<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Вход - errorbin</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{background:#000;color:#fff;font-family:Arial;padding:20px;min-height:100vh;display:flex;align-items:center}
        .login-container{width:100%;max-width:400px;margin:0 auto}
        .login-box{background:#111;border-radius:10px;padding:25px;border:2px solid red}
        h1{color:red;text-align:center;margin-bottom:25px;font-size:22px}
        h2{color:#fff;text-align:center;margin-bottom:20px;font-size:18px}
        .auth-form{display:none}
        .auth-form.active{display:block}
        .input-group{margin-bottom:15px}
        input{width:100%;padding:12px 15px;background:#222;border:1px solid #333;border-radius:8px;color:#fff;font-size:14px}
        .btn{width:100%;padding:12px;border:none;border-radius:8px;font-size:15px;font-weight:bold;margin-top:10px}
        .btn-login{background:red;color:white}
        .btn-register{background:#0f0;color:#000}
        .auth-switch{text-align:center;margin-top:15px;color:#888;font-size:13px}
        .auth-switch a{color:red;text-decoration:none;font-weight:bold}
        .back-btn{display:block;text-align:center;margin-top:25px;color:#888;text-decoration:none}
        .message{background:red;color:white;padding:10px;border-radius:5px;margin-bottom:15px;text-align:center;display:none}
        .message.success{background:#0f0;color:#000}
    </style>
</head>
<body>
    <div class="login-container">
        <div class="login-box">
            <h1>errorbin</h1>
            
            <div class="message" id="message"></div>
            
            <form id="loginForm" class="auth-form active">
                <h2>Вход</h2>
                <div class="input-group">
                    <input type="text" id="loginUsername" placeholder="Юзернейм или ID" required>
                </div>
                <div class="input-group">
                    <input type="password" id="loginPassword" placeholder="Пароль" required>
                </div>
                <button type="submit" class="btn btn-login">Войти</button>
                <p class="auth-switch">Нет аккаунта? <a href="#" id="showRegister">Зарегистрироваться</a></p>
            </form>
            
            <form id="registerForm" class="auth-form">
                <h2>Регистрация</h2>
                <div class="input-group">
                    <input type="text" id="regUsername" placeholder="Придумайте юзернейм" required>
                </div>
                <div class="input-group">
                    <input type="password" id="regPassword" placeholder="Пароль" required>
                </div>
                <div class="input-group">
                    <input type="password" id="regConfirmPassword" placeholder="Повторите пароль" required>
                </div>
                <button type="submit" class="btn btn-register">Зарегистрироваться</button>
                <p class="auth-switch">Есть аккаунт? <a href="#" id="showLogin">Войти</a></p>
            </form>
            
            <a href="index.html" class="back-btn">← На главную</a>
        </div>
    </div>

    <script>
        const DB_KEY = 'errorbin_global_db';
        
        function showMessage(text, type = 'error') {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = 'message ' + (type === 'success' ? 'success' : '');
            msg.style.display = 'block';
            setTimeout(() => msg.style.display = 'none', 3000);
        }
        
        function getDB() {
            return JSON.parse(localStorage.getItem(DB_KEY));
        }
        
        function saveDB(db) {
            localStorage.setItem(DB_KEY, JSON.stringify(db));
        }
        
        // Переключение форм
        document.getElementById('showRegister').onclick = (e) => {
            e.preventDefault();
            document.getElementById('loginForm').classList.remove('active');
            document.getElementById('registerForm').classList.add('active');
        };
        
        document.getElementById('showLogin').onclick = (e) => {
            e.preventDefault();
            document.getElementById('registerForm').classList.remove('active');
            document.getElementById('loginForm').classList.add('active');
        };
        
        // Вход
        document.getElementById('loginForm').onsubmit = (e) => {
            e.preventDefault();
            
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            
            if (!username || !password) {
                showMessage('Заполните все поля');
                return;
            }
            
            const db = getDB();
            
            // Проверка админа
            if ((username === '5158507042' || username === '7072507352') && password === '199221') {
                localStorage.setItem('current_user', JSON.stringify({
                    username: username,
                    isAdmin: true
                }));
                showMessage('Вход как администратор выполнен!', 'success');
                setTimeout(() => window.location.href = 'index.html', 1000);
                return;
            }
            
            // Проверка обычного пользователя
            const user = db.users.find(u => u.username === username && u.password === password);
            if (user) {
                localStorage.setItem('current_user', JSON.stringify({
                    username: user.username,
                    isAdmin: false
                }));
                showMessage('Вход выполнен!', 'success');
                setTimeout(() => window.location.href = 'index.html', 1000);
            } else {
                showMessage('Неверный логин или пароль');
            }
        };
        
        // Регистрация
        document.getElementById('registerForm').onsubmit = (e) => {
            e.preventDefault();
            
            const username = document.getElementById('regUsername').value.trim();
            const password = document.getElementById('regPassword').value.trim();
            const confirmPassword = document.getElementById('regConfirmPassword').value.trim();
            
            if (!username || !password || !confirmPassword) {
                showMessage('Заполните все поля');
                return;
            }
            
            if (password !== confirmPassword) {
                showMessage('Пароли не совпадают');
                return;
            }
            
            if (username.length < 3) {
                showMessage('Юзернейм должен быть от 3 символов');
                return;
            }
            
            if (password.length < 4) {
                showMessage('Пароль должен быть от 4 символов');
                return;
            }
            
            // Запрет на имена админов
            if (username === '5158507042' || username === '7072507352') {
                showMessage('Этот юзернейм зарезервирован');
                return;
            }
            
            const db = getDB();
            
            // Проверка на занятость
            if (db.users.some(u => u.username === username)) {
                showMessage('Этот юзернейм уже занят');
                return;
            }
            
            // Добавление пользователя
            db.users.push({
                username: username,
                password: password
            });
            saveDB(db);
            
            // Автовход
            localStorage.setItem('current_user', JSON.stringify({
                username: username,
                isAdmin: false
            }));
            
            showMessage('Регистрация успешна!', 'success');
            setTimeout(() => window.location.href = 'index.html', 1000);
        };
    </script>
</body>
</html>
