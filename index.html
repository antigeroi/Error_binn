<!DOCTYPE html>
<html>
<head>
    <title>ErrorBin</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { background: #111; color: #fff; font-family: Arial; margin: 0; }
        .header { background: #222; padding: 15px; border-bottom: 2px solid red; display: flex; justify-content: space-between; align-items: center; }
        h1 { color: red; margin: 0; }
        .admin-btn { background: red; color: white; padding: 8px 15px; border-radius: 5px; text-decoration: none; }
        .search-box { padding: 15px; background: #1a1a1a; }
        .search-input { width: 100%; padding: 12px; background: #333; border: 1px solid #444; border-radius: 20px; color: white; }
        .pastes-container { padding: 15px; }
        .paste-card { background: #222; border-radius: 10px; padding: 15px; margin-bottom: 10px; border-left: 4px solid #0f0; cursor: pointer; }
        .paste-card:hover { background: #2a2a2a; }
        .paste-lika { color: #0f0; font-weight: bold; }
        .paste-author { color: #888; font-size: 12px; }
        .fab { position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; background: white; border-radius: 30px; display: flex; align-items: center; justify-content: center; color: red; font-size: 30px; text-decoration: none; }
        .no-pastes { text-align: center; padding: 50px; color: #888; }
        .paste-tag { background: red; color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px; margin-left: 5px; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; }
        .modal-content { background: #222; margin: 50px auto; padding: 20px; border-radius: 10px; width: 95%; max-width: 600px; }
        .close-modal { color: white; font-size: 30px; float: right; cursor: pointer; }
        .modal-section { margin-bottom: 20px; }
        .modal-label { color: #888; font-size: 14px; margin-bottom: 5px; }
        .modal-text { background: #111; padding: 15px; border-radius: 5px; white-space: pre-wrap; word-break: break-word; }
        .copy-btn { background: #0088cc; color: white; border: none; padding: 8px 15px; border-radius: 5px; margin-top: 10px; cursor: pointer; }
        .login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #111; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10000; }
        .login-box { background: #222; padding: 30px; border-radius: 15px; width: 90%; max-width: 400px; border: 2px solid red; text-align: center; }
        .login-title { color: red; margin-bottom: 20px; }
        .login-input { width: 100%; padding: 15px; background: #333; border: 1px solid #444; border-radius: 8px; color: white; text-align: center; font-size: 18px; margin-bottom: 15px; }
        .login-btn { width: 100%; padding: 15px; background: red; color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; }
        .login-error { color: red; margin-top: 10px; display: none; }
    </style>
</head>
<body>

<div id="loginScreen" class="login-screen">
    <div class="login-box">
        <h1 class="login-title">üîí ERRORBIN</h1>
        <input type="password" class="login-input" id="passwordInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞" autocomplete="off">
        <button class="login-btn" onclick="checkPassword()">–í–û–ô–¢–ò</button>
        <div class="login-error" id="loginError">‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!</div>
    </div>
</div>

<div id="mainScreen" style="display: none;">
    <div class="header">
        <h1>ErrorBin</h1>
        <a href="moderation.html" class="admin-btn">–ê–¥–º–∏–Ω</a>
    </div>

    <div class="search-box">
        <input type="text" class="search-input" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –ª–∏–∫–∞–º –∏–ª–∏ #—Ñ–µ–π–º" id="searchInput">
    </div>

    <div class="pastes-container" id="pastesContainer">
        <div class="no-pastes">üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Å—Ç...</div>
    </div>

    <a href="create.html" class="fab">+</a>

    <div class="modal" id="pasteModal">
        <div class="modal-content">
            <div class="close-modal" onclick="closeModal()">&times;</div>
            <div class="modal-section">
                <div class="modal-label">üîë –õ–ò–ö–ê:</div>
                <div class="modal-text" id="modalLika"></div>
            </div>
            <div class="modal-section">
                <div class="modal-label">‚úÖ –í–ê–õ–ò–î–ê–¶–ò–Ø:</div>
                <div class="modal-text" id="modalValidation"></div>
                <button class="copy-btn" onclick="copyToClipboard('validation')">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é</button>
            </div>
            <div class="modal-section">
                <div class="modal-label">üìÑ –ü–ê–°–¢–ê:</div>
                <div class="modal-text" id="modalContent"></div>
                <button class="copy-btn" onclick="copyToClipboard('content')">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Å—Ç—É</button>
            </div>
        </div>
    </div>
</div>

<script>
// üõ°Ô∏è –ú–ê–¢–ï–ú–ê–¢–ò–ß–ï–°–ö–û–ï –®–ò–§–†–û–í–ê–ù–ò–ï –ö–õ–Æ–ß–ï–ô
function getConfig() {
    // –ö–ª—é—á–∏ —Ä–∞–∑–±–∏—Ç—ã –Ω–∞ —á–∞—Å—Ç–∏ –∏ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω—ã –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏
    const parts = {
        a: [54, 57, 53, 56, 55, 57, 102, 50, 97, 101, 53, 57, 54, 101, 55, 48, 56, 102, 99, 49, 51, 102, 53, 55],
        b: [36, 50, 97, 36, 49, 48, 36, 108, 77, 51, 119, 72, 87, 102, 53, 111, 104, 69, 49, 99, 74, 48, 75, 47, 116, 110, 48, 55, 101, 86, 117, 106, 55, 87, 56, 48, 90, 108, 106, 120, 100, 119, 74, 85, 97, 78, 68, 47, 99, 66, 79, 81, 100, 75, 75, 120, 112, 116, 86, 67],
        c: [49, 50, 50, 51, 51, 49]
    };
    
    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –æ–±—Ä–∞—Ç–Ω–æ –≤ —Å—Ç—Ä–æ–∫—É
    return {
        BIN_ID: String.fromCharCode(...parts.a),
        MASTER_KEY: String.fromCharCode(...parts.b),
        ADMIN_PASS: String.fromCharCode(...parts.c)
    };
}

let CONFIG = null;

// üîê –ü–†–û–í–ï–†–ö–ê –ü–ê–†–û–õ–Ø
function checkPassword() {
    const password = document.getElementById('passwordInput').value;
    const errorElem = document.getElementById('loginError');
    
    // –ü–∞—Ä–æ–ª—å –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∏–∑ –∏–º–µ–Ω–∏ —Å–∞–π—Ç–∞
    const siteName = "errorbin";
    const expectedPassword = siteName.split('').map(c => 
        String.fromCharCode(c.charCodeAt(0) + 3)
    ).join('');
    
    if (password === "122331" || password === "error" || password === expectedPassword) {
        CONFIG = getConfig();
        localStorage.setItem('eb_auth', '1');
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('mainScreen').style.display = 'block';
        loadPastes();
    } else {
        errorElem.style.display = 'block';
        document.getElementById('passwordInput').value = '';
    }
}

// üì• –ó–ê–ì–†–£–ó–ò–¢–¨ –ü–ê–°–¢–´ (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô URL)
async function loadPastes() {
    try {
        const container = document.getElementById('pastesContainer');
        container.innerHTML = '<div class="no-pastes">üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Å—Ç...</div>';
        
        // –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô URL - –±–µ–∑ /latest
        const response = await fetch(
            `https://api.jsonbin.io/v3/b/${CONFIG.BIN_ID}`,
            { 
                headers: { 
                    'X-Master-Key': CONFIG.MASTER_KEY,
                    'X-Bin-Versioning': 'false'
                } 
            }
        );
        
        if (!response.ok) {
            if (response.status === 404) {
                throw new Error('BIN –Ω–µ –Ω–∞–π–¥–µ–Ω! –ü—Ä–æ–≤–µ—Ä—å BIN_ID');
            }
            throw new Error(`–û—à–∏–±–∫–∞ ${response.status}`);
        }
        
        const data = await response.json();
        const approved = data.record.pastes.filter(p => p.status === 'approved');
        
        displayPastes(approved);
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        document.getElementById('pastesContainer').innerHTML = 
            `<div class="no-pastes" style="color:red">‚ùå ${error.message}</div>`;
    }
}

// üì§ –ü–û–ö–ê–ó–ê–¢–¨ –ü–ê–°–¢–´
function displayPastes(pastes) {
    const container = document.getElementById('pastesContainer');
    
    if (pastes.length === 0) {
        container.innerHTML = '<div class="no-pastes">üì≠ –ü–∞—Å—Ç –ø–æ–∫–∞ –Ω–µ—Ç</div>';
        return;
    }
    
    container.innerHTML = pastes.map(paste => `
        <div class="paste-card" onclick="showFullPaste(${paste.id})">
            <div class="paste-lika">
                üîë ${escapeHtml(paste.lika)}
                ${paste.tag ? `<span class="paste-tag">${paste.tag}</span>` : ''}
            </div>
            <div class="paste-author">üë§ ${escapeHtml(paste.author)} ‚Ä¢ üìÖ ${paste.date}</div>
        </div>
    `).join('');
}

// üëÅÔ∏è –ü–û–ö–ê–ó–ê–¢–¨ –ü–û–õ–ù–£–Æ –ü–ê–°–¢–£
async function showFullPaste(pasteId) {
    try {
        const response = await fetch(
            `https://api.jsonbin.io/v3/b/${CONFIG.BIN_ID}`,
            { headers: { 'X-Master-Key': CONFIG.MASTER_KEY } }
        );
        
        const data = await response.json();
        const paste = data.record.pastes.find(p => p.id === pasteId);
        
        if (!paste) return;
        
        document.getElementById('modalLika').textContent = paste.lika;
        document.getElementById('modalValidation').textContent = paste.validation;
        document.getElementById('modalContent').textContent = paste.content;
        
        document.getElementById('pasteModal').style.display = 'block';
        document.getElementById('pasteModal').dataset.pasteId = pasteId;
    } catch (error) {
        alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞—Å—Ç—ã');
    }
}

// ‚ùå –ó–ê–ö–†–´–¢–¨ –ú–û–î–ê–õ–ö–£
function closeModal() {
    document.getElementById('pasteModal').style.display = 'none';
}

// üìã –ö–û–ü–ò–†–û–í–ê–¢–¨
async function copyToClipboard(type) {
    const text = type === 'validation' 
        ? document.getElementById('modalValidation').textContent 
        : document.getElementById('modalContent').textContent;
    
    try {
        await navigator.clipboard.writeText(text);
        alert('‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!');
    } catch (err) {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        alert('‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!');
    }
}

// üîç –ü–û–ò–°–ö
document.getElementById('searchInput').addEventListener('input', async function(e) {
    const query = e.target.value.toLowerCase();
    if (!query) {
        loadPastes();
        return;
    }
    
    try {
        const response = await fetch(
            `https://api.jsonbin.io/v3/b/${CONFIG.BIN_ID}`,
            { headers: { 'X-Master-Key': CONFIG.MASTER_KEY } }
        );
        
        const data = await response.json();
        const approved = data.record.pastes.filter(p => p.status === 'approved');
        
        let filtered = approved;
        if (query === '#—Ñ–µ–π–º' || query === '—Ñ–µ–π–º') {
            filtered = approved.filter(p => p.tag === '#—Ñ–µ–π–º');
        } else {
            filtered = approved.filter(p => 
                p.lika.toLowerCase().includes(query) ||
                p.author.toLowerCase().includes(query)
            );
        }
        
        const container = document.getElementById('pastesContainer');
        if (filtered.length === 0) {
            container.innerHTML = '<div class="no-pastes">üîç –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
            return;
        }
        
        container.innerHTML = filtered.map(paste => `
            <div class="paste-card" onclick="showFullPaste(${paste.id})">
                <div class="paste-lika">${escapeHtml(paste.lika)}</div>
                <div class="paste-author">${escapeHtml(paste.author)}</div>
            </div>
        `).join('');
    } catch (error) {
        console.error('Search error:', error);
    }
});

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// –ê–í–¢–û-–í–•–û–î
window.addEventListener('DOMContentLoaded', () => {
    const auth = localStorage.getItem('eb_auth');
    if (auth) {
        CONFIG = getConfig();
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('mainScreen').style.display = 'block';
        loadPastes();
    }
});

// ENTER –î–õ–Ø –í–•–û–î–ê
document.getElementById('passwordInput').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') checkPassword();
});

// –ó–ê–ö–†–´–¢–ò–ï –ú–û–î–ê–õ–ö–ò
window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeModal();
});

window.addEventListener('click', (e) => {
    if (e.target.classList.contains('modal')) closeModal();
});
</script>
</body>
</html>