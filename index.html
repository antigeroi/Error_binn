<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>errorbin</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{background:#000;color:#fff;font-family:Arial;font-size:14px}
        .header{background:#111;padding:12px 15px;border-bottom:2px solid red;display:flex;justify-content:space-between;align-items:center;position:fixed;top:0;width:100%;z-index:100}
        .header h1{color:red;font-size:18px}
        .menu-btn{background:#222;border:none;color:#fff;padding:8px 12px;border-radius:5px;font-size:13px}
        .user-area{display:flex;align-items:center;gap:10px}
        .username{color:#0f0;font-size:12px;font-weight:bold}
        .mod-btn{background:red;color:white;padding:6px 10px;border-radius:5px;font-size:12px;text-decoration:none}
        .logout-btn{background:transparent;border:1px solid red;color:red;padding:4px 8px;border-radius:5px;font-size:11px}
        .search-box{padding:15px;background:#111;margin-top:50px}
        .search-input{width:100%;padding:10px;background:#222;border:1px solid #333;border-radius:20px;color:#fff;font-size:14px}
        .pastes-container{padding:15px;padding-bottom:70px}
        .paste-card{background:#111;border-radius:8px;padding:12px;margin-bottom:10px;border-left:3px solid #0f0}
        .paste-lika{color:#0f0;font-weight:bold;font-size:15px;margin-bottom:5px}
        .paste-tag{display:inline-block;background:red;color:white;padding:2px 8px;border-radius:10px;font-size:11px;margin-left:5px}
        .paste-author{color:#888;font-size:12px}
        .fab{position:fixed;bottom:20px;right:20px;width:50px;height:50px;background:#fff;border-radius:25px;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 10px rgba(255,0,0,0.4);z-index:99}
        .fab-plus{color:red;font-size:24px;font-weight:bold}
        .about-panel{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:1000;padding:20px}
        .about-content{background:#111;border-radius:10px;padding:20px;margin-top:50px;border:1px solid red}
        .close-btn{float:right;background:none;border:none;color:#fff;font-size:24px}
        .no-pastes{text-align:center;padding:50px 20px;color:#666}
        .message{position:fixed;top:20px;right:20px;background:red;color:white;padding:10px 15px;border-radius:5px;z-index:1001;display:none}
        .message.success{background:#0f0;color:#000}
    </style>
</head>
<body>
    <div class="header">
        <button class="menu-btn" id="aboutBtn">О сайте</button>
        <h1>errorbin</h1>
        <div class="user-area" id="userArea">
            <!-- Здесь будет пользователь и кнопки -->
        </div>
    </div>

    <div class="about-panel" id="aboutPanel">
        <div class="about-content">
            <button class="close-btn" id="closeAboutBtn">×</button>
            <p>Данный сайт создан для публикации паст в строго формате:</p>
            <p>1. Лика (кто сделал)</p>
            <p>2. Цепочка валидации</p>
            <p>3. Сама паста</p>
            <p>Создал @error_XU</p>
        </div>
    </div>

    <div class="message" id="message"></div>

    <div class="search-box">
        <input type="text" class="search-input" id="searchInput" placeholder="Поиск по ликам или #фейм">
    </div>

    <div class="pastes-container" id="pastesContainer">
        <div class="no-pastes">Загрузка паст...</div>
    </div>

    <div class="fab" id="fabBtn">
        <div class="fab-plus">+</div>
    </div>

    <script>
        // ===== ОБЩАЯ БАЗА ДАННЫХ =====
        const DB_KEY = 'errorbin_global_db';
        
        // Инициализация базы
        function initDB() {
            if (!localStorage.getItem(DB_KEY)) {
                const initialDB = {
                    users: [
                        {username: '5158507042', password: '199221', isAdmin: true},
                        {username: '7072507352', password: '199221', isAdmin: true}
                    ],
                    pastes: []
                };
                localStorage.setItem(DB_KEY, JSON.stringify(initialDB));
            }
        }
        
        // Получить базу
        function getDB() {
            return JSON.parse(localStorage.getItem(DB_KEY));
        }
        
        // Сохранить базу
        function saveDB(db) {
            localStorage.setItem(DB_KEY, JSON.stringify(db));
        }
        
        // ===== ПОЛЬЗОВАТЕЛИ =====
        let currentUser = JSON.parse(localStorage.getItem('current_user')) || null;
        
        // Обновить интерфейс пользователя
        function updateUserUI() {
            const userArea = document.getElementById('userArea');
            if (currentUser) {
                userArea.innerHTML = `
                    <span class="username">${currentUser.username}</span>
                    ${currentUser.isAdmin ? '<a href="moderation.html" class="mod-btn">Модерация</a>' : ''}
                    <button class="logout-btn" onclick="logout()">Выйти</button>
                `;
            } else {
                userArea.innerHTML = '<a href="login.html" style="color:#0f0;font-size:13px">Войти</a>';
            }
        }
        
        // Выход
        function logout() {
            localStorage.removeItem('current_user');
            currentUser = null;
            updateUserUI();
            showMessage('Вы вышли из системы', 'success');
        }
        
        // ===== ПАСТЫ =====
        function loadPastes() {
            const db = getDB();
            const approvedPastes = db.pastes.filter(p => p.status === 'approved');
            displayPastes(approvedPastes);
        }
        
        function displayPastes(pastes) {
            const container = document.getElementById('pastesContainer');
            
            if (pastes.length === 0) {
                container.innerHTML = '<div class="no-pastes">Нет одобренных паст</div>';
                return;
            }
            
            container.innerHTML = pastes.map(paste => `
                <div class="paste-card" onclick="viewPaste('${paste.id}')">
                    <div class="paste-lika">
                        ${escapeHtml(paste.lika)}
                        ${paste.tag ? `<span class="paste-tag">${paste.tag}</span>` : ''}
                    </div>
                    <div class="paste-author">by ${escapeHtml(paste.author)}</div>
                </div>
            `).join('');
        }
        
        function viewPaste(id) {
            const db = getDB();
            const paste = db.pastes.find(p => p.id === id);
            if (!paste) return;
            
            const content = `
                Лика: ${paste.lika}
                Автор: ${paste.author}
                Статус: ${paste.status}
                ${paste.tag ? `Тег: ${paste.tag}` : ''}
                
                Валидация:
                ${paste.validation}
                
                Паста:
                ${paste.content}
            `;
            alert(content);
        }
        
        // ===== ПОИСК =====
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', function(e) {
                const query = e.target.value.toLowerCase();
                const db = getDB();
                
                if (query === '#фейм' || query === 'фейм') {
                    const famePastes = db.pastes.filter(p => p.tag === '#фейм' && p.status === 'approved');
                    displayPastes(famePastes);
                    return;
                }
                
                if (!query) {
                    loadPastes();
                    return;
                }
                
                const filtered = db.pastes.filter(p => 
                    p.status === 'approved' && 
                    (p.lika.toLowerCase().includes(query) || p.author.toLowerCase().includes(query))
                );
                displayPastes(filtered);
            });
        }
        
        // ===== ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ =====
        function showMessage(text, type = 'error') {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = 'message ' + (type === 'success' ? 'success' : '');
            msg.style.display = 'block';
            setTimeout(() => msg.style.display = 'none', 3000);
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // ===== ИНИЦИАЛИЗАЦИЯ =====
        function init() {
            initDB(); // Инициализация общей базы
            updateUserUI(); // Обновление интерфейса пользователя
            loadPastes(); // Загрузка паст
            setupSearch(); // Настройка поиска
            
            // О сайте
            document.getElementById('aboutBtn').onclick = () => {
                document.getElementById('aboutPanel').style.display = 'block';
            };
            document.getElementById('closeAboutBtn').onclick = () => {
                document.getElementById('aboutPanel').style.display = 'none';
            };
            
            // Кнопка создания
            document.getElementById('fabBtn').onclick = () => {
                if (!currentUser) {
                    window.location.href = 'login.html';
                } else {
                    window.location.href = 'create.html';
                }
            };
        }
        
        // Запуск
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
  </html>
