<!DOCTYPE html>
<html>
<head>
    <title>errorbin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body{background:#1a1a1a;color:white;font-family:Arial;margin:0}
        .header{background:#2a2a2a;padding:15px;border-bottom:2px solid red;display:flex;justify-content:space-between;align-items:center}
        h1{color:red;margin:0;font-size:18px}
        .admin-btn{background:red;color:white;padding:5px 10px;border-radius:5px;text-decoration:none;font-size:12px}
        .search-box{padding:15px;background:#2a2a2a}
        .search-input{width:100%;padding:10px;background:#3a3a3a;border:1px solid #4a4a4a;border-radius:20px;color:white}
        .pastes-container{padding:15px}
        .paste-card{background:#2a2a2a;border-radius:8px;padding:12px;margin-bottom:10px;border-left:3px solid #0f0}
        .paste-lika{color:#0f0;font-weight:bold}
        .paste-author{color:#888;font-size:12px}
        .fab{position:fixed;bottom:20px;right:20px;width:50px;height:50px;background:white;border-radius:25px;display:flex;align-items:center;justify-content:center;color:red;font-size:24px}
        .no-pastes{text-align:center;padding:50px;color:#888}
        .paste-tag{background:red;color:white;padding:2px 8px;border-radius:10px;font-size:11px;margin-left:5px}
    </style>
</head>
<body>
    <div class="header">
        <h1>errorbin</h1>
        <a href="moderation.html" class="admin-btn">Админ</a>
    </div>

    <div class="search-box">
        <input type="text" class="search-input" placeholder="Поиск по ликам или #фейм" id="searchInput">
    </div>

    <div class="pastes-container" id="pastesContainer">
        <div class="no-pastes">Загрузка паст...</div>
    </div>

    <div class="fab" onclick="window.location='create.html'">+</div>

    <script>
        // НАСТРОЙКИ JSONBIN
        const BIN_ID = '695858f1ae596e708fc0ffea';
        const MASTER_KEY = '$2a$10$ftDuSkomUMvmkGtIeeIAMebzWHBRhLWA.xaosW/.pc8G1ys2HPcxG';
        const JSONBIN_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;
        
        // ПОКАЗАТЬ СООБЩЕНИЕ
        function showMessage(text, type = 'error') {
            const msg = document.createElement('div');
            msg.textContent = text;
            msg.style.cssText = `
                position:fixed;top:20px;right:20px;
                background:${type === 'success' ? '#0f0' : 'red'};
                color:${type === 'success' ? '#000' : 'white'};
                padding:10px 15px;border-radius:5px;z-index:1000;
            `;
            document.body.appendChild(msg);
            setTimeout(() => msg.remove(), 3000);
        }
        
        // ЗАГРУЗИТЬ БАЗУ
        async function loadDatabase() {
            try {
                const response = await fetch(JSONBIN_URL + '/latest', {
                    headers: {
                        'X-Master-Key': MASTER_KEY
                    }
                });
                
                if (!response.ok) throw new Error('Ошибка загрузки');
                const data = await response.json();
                return data.record;
            } catch (error) {
                console.error('Ошибка:', error);
                showMessage('Ошибка загрузки базы');
                return { pastes: [], users: [] };
            }
        }
        
        // ПОКАЗАТЬ ПАСТЫ
        async function showPastes() {
            const db = await loadDatabase();
            const approved = db.pastes.filter(p => p.status === 'approved');
            
            const container = document.getElementById('pastesContainer');
            if (!approved.length) {
                container.innerHTML = '<div class="no-pastes">Нет паст</div>';
                return;
            }
            
            container.innerHTML = approved.map(p => `
                <div class="paste-card">
                    <div class="paste-lika">
                        ${escapeHtml(p.lika)}
                        ${p.tag ? `<span class="paste-tag">${p.tag}</span>` : ''}
                    </div>
                    <div class="paste-author">by ${escapeHtml(p.author)}</div>
                </div>
            `).join('');
        }
        
        // ПОИСК
        document.getElementById('searchInput').addEventListener('input', async function(e) {
            const db = await loadDatabase();
            const approved = db.pastes.filter(p => p.status === 'approved');
            const query = e.target.value.toLowerCase();
            
            if (query === '#фейм' || query === 'фейм') {
                const famePastes = approved.filter(p => p.tag === '#фейм');
                const container = document.getElementById('pastesContainer');
                container.innerHTML = famePastes.map(p => `
                    <div class="paste-card">
                        <div class="paste-lika">${escapeHtml(p.lika)}</div>
                        <div class="paste-author">by ${escapeHtml(p.author)}</div>
                    </div>
                `).join('');
                return;
            }
            
            const filtered = approved.filter(p => 
                p.lika.toLowerCase().includes(query) ||
                p.author.toLowerCase().includes(query)
            );
            
            const container = document.getElementById('pastesContainer');
            container.innerHTML = filtered.map(p => `
                <div class="paste-card">
                    <div class="paste-lika">${escapeHtml(p.lika)}</div>
                    <div class="paste-author">by ${escapeHtml(p.author)}</div>
                </div>
            `).join('');
        });
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // ЗАПУСК
        showPastes();
    </script>
</body>
</html>