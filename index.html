<!DOCTYPE html>
<html>
<head>
    <title>errorbin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body{background:#1a1a1a;color:white;font-family:Arial;margin:0}
        .header{background:#2a2a2a;padding:15px;border-bottom:2px solid red;display:flex;justify-content:space-between;align-items:center}
        h1{color:red;margin:0;font-size:18px}
        .admin-btn{background:red;color:white;padding:5px 10px;border-radius:5px;text-decoration:none;font-size:12px}
        .search-box{padding:15px;background:#2a2a2a}
        .search-input{width:100%;padding:10px;background:#3a3a3a;border:1px solid #4a4a4a;border-radius:20px;color:white}
        .pastes-container{padding:15px}
        .paste-card{background:#2a2a2a;border-radius:8px;padding:12px;margin-bottom:10px;border-left:3px solid #0f0;cursor:pointer}
        .paste-card:hover{background:#333}
        .paste-lika{color:#0f0;font-weight:bold}
        .paste-author{color:#888;font-size:12px}
        .fab{position:fixed;bottom:20px;right:20px;width:50px;height:50px;background:white;border-radius:25px;display:flex;align-items:center;justify-content:center;color:red;font-size:24px;cursor:pointer}
        .no-pastes{text-align:center;padding:50px;color:#888}
        .paste-tag{background:red;color:white;padding:2px 8px;border-radius:10px;font-size:11px;margin-left:5px}
        
        .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:1000;overflow-y:auto}
        .modal-content{background:#2a2a2a;margin:50px auto;padding:20px;border-radius:10px;width:90%;max-width:600px}
        .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;border-bottom:1px solid #444;padding-bottom:10px}
        .modal-title{color:#0f0;font-size:18px;margin:0}
        .close-modal{color:white;font-size:28px;cursor:pointer;background:none;border:none}
        .modal-section{margin-bottom:20px}
        .modal-label{color:#888;font-size:14px;margin-bottom:5px}
        .modal-text{background:#1a1a1a;padding:15px;border-radius:8px;white-space:pre-wrap;word-break:break-word}
        .modal-footer{color:#888;font-size:12px;margin-top:20px;border-top:1px solid #444;padding-top:10px;display:flex;justify-content:space-between}
        .copy-btn{background:#0088cc;color:white;border:none;padding:8px 15px;border-radius:5px;cursor:pointer;margin-top:10px}
        .copy-btn:hover{background:#0077bb}
    </style>
</head>
<body>
    <div class="header">
        <h1>errorbin</h1>
        <a href="moderation.html" class="admin-btn">Админ</a>
    </div>

    <div class="search-box">
        <input type="text" class="search-input" placeholder="Поиск по ликам или #фейм" id="searchInput">
    </div>

    <div class="pastes-container" id="pastesContainer">
        <div class="no-pastes">Загрузка паст...</div>
    </div>

    <div class="fab" onclick="window.location='create.html'">+</div>

    <div class="modal" id="pasteModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle"></div>
                <button class="close-modal" onclick="closeModal()">&times;</button>
            </div>
            
            <div class="modal-section">
                <div class="modal-label">ЛИКА:</div>
                <div class="modal-text" id="modalLika"></div>
            </div>
            
            <div class="modal-section">
                <div class="modal-label">ВАЛИДАЦИЯ:</div>
                <div class="modal-text" id="modalValidation"></div>
                <button class="copy-btn" onclick="copyToClipboard('validation')">Копировать валидацию</button>
            </div>
            
            <div class="modal-section">
                <div class="modal-label">ПАСТА:</div>
                <div class="modal-text" id="modalContent"></div>
                <button class="copy-btn" onclick="copyToClipboard('content')">Копировать пасту</button>
            </div>
            
            <div class="modal-footer">
                <div id="modalAuthor"></div>
                <div id="modalDate"></div>
            </div>
        </div>
    </div>

    <script>
        //  айди
        const KEY_PARTS = [
            '69591', 'f4fd0', 'ea881', 'f4051', 'bb2c',
            '$2a$10$', 'g0Tdx', 'dSYW/', 'Hh9TU', 'g2G4h',
            'Zetpi', 'yczSH', 'WWJC', 'yXqwc', '8ylCY',
            '.k5pU', 'smU2',
            '122', '331'
        ];
        
        //  СОБИРАЕМ АЙДИ
        const BIN_ID = KEY_PARTS[0] + KEY_PARTS[1] + KEY_PARTS[2] + KEY_PARTS[3] + KEY_PARTS[4];
        const MASTER_KEY = KEY_PARTS[5] + KEY_PARTS[6] + KEY_PARTS[7] + KEY_PARTS[8] + KEY_PARTS[9] + 
                          KEY_PARTS[10] + KEY_PARTS[11] + KEY_PARTS[12] + KEY_PARTS[13] + KEY_PARTS[14] + 
                          KEY_PARTS[15] + KEY_PARTS[16];
        const ADMIN_PASS = KEY_PARTS[17] + KEY_PARTS[18];
        
        const JSONBIN_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;
        
        // ПОКАЗАТЬ СООБЩЕНИЕ
        function showMessage(text, type = 'error') {
            const msg = document.createElement('div');
            msg.textContent = text;
            msg.style.cssText = `
                position:fixed;top:20px;right:20px;
                background:${type === 'success' ? '#0f0' : 'red'};
                color:${type === 'success' ? '#000' : 'white'};
                padding:10px 15px;border-radius:5px;z-index:1000;
            `;
            document.body.appendChild(msg);
            setTimeout(() => msg.remove(), 3000);
        }
        
        // ЗАГРУЗИТЬ БАЗУ
        async function loadDatabase() {
            try {
                const response = await fetch(JSONBIN_URL + '/latest', {
                    headers: {
                        'X-Master-Key': MASTER_KEY
                    }
                });
                
                if (!response.ok) throw new Error('Ошибка загрузки');
                const data = await response.json();
                return data.record;
            } catch (error) {
                console.error('Ошибка:', error);
                showMessage('Ошибка загрузки базы');
                return { pastes: [], users: [] };
            }
        }
        
        // ПОКАЗАТЬ ПАСТЫ
        async function showPastes() {
            const db = await loadDatabase();
            const approved = db.pastes.filter(p => p.status === 'approved');
            
            const container = document.getElementById('pastesContainer');
            if (!approved.length) {
                container.innerHTML = '<div class="no-pastes">Нет паст</div>';
                return;
            }
            
            container.innerHTML = approved.map(p => `
                <div class="paste-card" onclick="showFullPaste(${p.id})">
                    <div class="paste-lika">
                        ${escapeHtml(p.lika)}
                        ${p.tag ? `<span class="paste-tag">${p.tag}</span>` : ''}
                    </div>
                    <div class="paste-author">by ${escapeHtml(p.author)} • ${p.date}</div>
                </div>
            `).join('');
        }
        
        // ПОКАЗАТЬ ПОЛНУЮ ИНФОРМАЦИЮ О ПАСТЕ
        async function showFullPaste(pasteId) {
            const db = await loadDatabase();
            const paste = db.pastes.find(p => p.id === pasteId);
            
            if (!paste) {
                showMessage('Паста не найдена');
                return;
            }
            
            document.getElementById('modalTitle').textContent = 'Паста #' + pasteId;
            document.getElementById('modalLika').textContent = paste.lika;
            document.getElementById('modalValidation').textContent = paste.validation;
            document.getElementById('modalContent').textContent = paste.content;
            document.getElementById('modalAuthor').textContent = 'by ' + paste.author;
            document.getElementById('modalDate').textContent = paste.date;
            
            document.getElementById('pasteModal').style.display = 'block';
            document.getElementById('pasteModal').dataset.currentPasteId = pasteId;
        }
        
        // ЗАКРЫТЬ МОДАЛЬНОЕ ОКНО
        function closeModal() {
            document.getElementById('pasteModal').style.display = 'none';
        }
        
        // КОПИРОВАТЬ ТЕКСТ В БУФЕР ОБМЕНА
        async function copyToClipboard(type) {
            const pasteId = document.getElementById('pasteModal').dataset.currentPasteId;
            if (!pasteId) return;
            
            const db = await loadDatabase();
            const paste = db.pastes.find(p => p.id === parseInt(pasteId));
            
            if (!paste) return;
            
            let textToCopy = '';
            if (type === 'validation') {
                textToCopy = paste.validation;
            } else if (type === 'content') {
                textToCopy = paste.content;
            }
            
            try {
                await navigator.clipboard.writeText(textToCopy);
                showMessage('Скопировано в буфер обмена!', 'success');
            } catch (err) {
                const textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showMessage('Скопировано в буфер обмена!', 'success');
            }
        }
        
        // ПОИСК
        document.getElementById('searchInput').addEventListener('input', async function(e) {
            const db = await loadDatabase();
            const approved = db.pastes.filter(p => p.status === 'approved');
            const query = e.target.value.toLowerCase();
            
            if (query === '#фейм' || query === 'фейм') {
                const famePastes = approved.filter(p => p.tag === '#фейм');
                const container = document.getElementById('pastesContainer');
                container.innerHTML = famePastes.map(p => `
                    <div class="paste-card" onclick="showFullPaste(${p.id})">
                        <div class="paste-lika">${escapeHtml(p.lika)}</div>
                        <div class="paste-author">by ${escapeHtml(p.author)} • ${p.date}</div>
                    </div>
                `).join('');
                return;
            }
            
            const filtered = approved.filter(p => 
                p.lika.toLowerCase().includes(query) ||
                p.author.toLowerCase().includes(query) ||
                p.validation.toLowerCase().includes(query) ||
                p.content.toLowerCase().includes(query)
            );
            
            const container = document.getElementById('pastesContainer');
            container.innerHTML = filtered.map(p => `
                <div class="paste-card" onclick="showFullPaste(${p.id})">
                    <div class="paste-lika">${escapeHtml(p.lika)}</div>
                    <div class="paste-author">by ${escapeHtml(p.author)} • ${p.date}</div>
                </div>
            `).join('');
        });
        
        // ЗАКРЫТЬ МОДАЛКУ ПРИ НАЖАТИИ ВНЕ ЕЕ
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('pasteModal');
            if (event.target === modal) {
                closeModal();
            }
        });
        
        // ЗАКРЫТЬ МОДАЛКУ ПРИ НАЖАТИИ ESC
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // ЗАПУСК
        showPastes();
    </script>
</body>
</html>