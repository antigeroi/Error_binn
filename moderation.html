<!DOCTYPE html>
<html>
<head>
    <title>Модерация</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body{background:#1a1a1a;color:white;font-family:Arial;padding:20px}
        .header{display:flex;align-items:center;margin-bottom:20px}
        .back-btn{color:white;text-decoration:none;font-size:20px;margin-right:10px}
        h1{color:red;margin:0}
        .paste-card{background:#2a2a2a;border-radius:8px;padding:15px;margin-bottom:10px;border-left:3px solid orange}
        .paste-lika{color:#0f0;font-weight:bold;margin-bottom:5px}
        .paste-preview{color:#ccc;font-size:13px;margin:10px 0}
        .actions{display:flex;gap:10px;margin-top:10px}
        .btn{flex:1;padding:8px;border:none;border-radius:5px;font-weight:bold}
        .approve{background:#0f0;color:black}
        .reject{background:red;color:white}
        .fame-check{margin-top:10px;color:#888;font-size:13px}
    </style>
</head>
<body>
    <div class="header">
        <a href="index.html" class="back-btn">←</a>
        <h1>Модерация</h1>
    </div>

    <div id="pendingContainer">
        <!-- Пасты на модерации -->
    </div>

    <script>
        const DB_KEY = 'errorbin_all_users';
        
        // ПАРОЛЬ АДМИНА
        const ADMIN_PASSWORD = '199221';
        
        // ПРОВЕРКА ПАРОЛЯ
        const password = prompt('Введите пароль администратора:');
        if(password !== ADMIN_PASSWORD) {
            alert('Неверный пароль!');
            window.location.href = 'index.html';
        }
        
        // ЗАГРУЗИТЬ ПАСТЫ НА МОДЕРАЦИЮ
        function loadPendingPastes() {
            const db = JSON.parse(localStorage.getItem(DB_KEY) || '{"pastes":[]}');
            const pending = db.pastes.filter(p => p.status === 'pending');
            
            const container = document.getElementById('pendingContainer');
            if(!pending.length) {
                container.innerHTML = '<div style="text-align:center;padding:50px;color:#888">Нет паст на модерации</div>';
                return;
            }
            
            container.innerHTML = pending.map(p => `
                <div class="paste-card" id="paste-${p.id}">
                    <div class="paste-lika">${escapeHtml(p.lika)}</div>
                    <div style="color:#888;font-size:12px">by ${escapeHtml(p.author)} • ${p.date}</div>
                    <div class="paste-preview">${escapeHtml(p.validation.substring(0, 100))}...</div>
                    <div class="fame-check">
                        <input type="checkbox" id="fame-${p.id}"> Добавить #фейм
                    </div>
                    <div class="actions">
                        <button class="btn approve" onclick="approvePaste(${p.id})">Одобрить</button>
                        <button class="btn reject" onclick="rejectPaste(${p.id})">Отклонить</button>
                    </div>
                </div>
            `).join('');
        }
        
        // ОДОБРИТЬ ПАСТУ
        function approvePaste(id) {
            const db = JSON.parse(localStorage.getItem(DB_KEY) || '{"pastes":[]}');
            const paste = db.pastes.find(p => p.id === id);
            
            if(paste) {
                paste.status = 'approved';
                // ДОБАВИТЬ ТЕГ #ФЕЙМ ЕСЛИ ВЫБРАНО
                if(document.getElementById(`fame-${id}`).checked) {
                    paste.tag = '#фейм';
                }
                localStorage.setItem(DB_KEY, JSON.stringify(db));
                document.getElementById(`paste-${id}`).remove();
                alert('Паста одобрена!');
            }
        }
        
        // ОТКЛОНИТЬ ПАСТУ
        function rejectPaste(id) {
            const db = JSON.parse(localStorage.getItem(DB_KEY) || '{"pastes":[]}');
            const paste = db.pastes.find(p => p.id === id);
            
            if(paste) {
                paste.status = 'rejected';
                localStorage.setItem(DB_KEY, JSON.stringify(db));
                document.getElementById(`paste-${id}`).remove();
                alert('Паста отклонена!');
            }
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        loadPendingPastes();
    </script>
</body>
</html>