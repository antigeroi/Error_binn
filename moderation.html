<!DOCTYPE html>
<html>
<head>
    <title>–ú–æ–¥–µ—Ä–∞—Ü–∏—è</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { background: #111; color: #fff; font-family: Arial; padding: 20px; }
        .header { display: flex; align-items: center; margin-bottom: 30px; }
        .back-btn { color: white; font-size: 30px; margin-right: 15px; text-decoration: none; }
        h1 { color: red; margin: 0; }
        .login-box { background: #222; padding: 40px; border-radius: 10px; max-width: 400px; margin: 100px auto; text-align: center; border: 2px solid red; }
        .login-input { padding: 15px; width: 100%; margin: 20px 0; background: #333; border: 1px solid #444; color: white; border-radius: 5px; text-align: center; }
        .login-btn { padding: 15px; width: 100%; background: red; color: white; border: none; border-radius: 5px; font-weight: bold; }
        .paste-card { background: #222; padding: 20px; margin: 15px 0; border-radius: 10px; border-left: 4px solid orange; }
        .paste-lika { color: orange; font-weight: bold; }
        .paste-preview { background: #111; padding: 15px; border-radius: 5px; margin: 10px 0; color: #ccc; font-size: 14px; }
        .controls { display: flex; gap: 10px; margin-top: 15px; }
        .control-btn { flex: 1; padding: 10px; border: none; border-radius: 5px; font-weight: bold; }
        .btn-approve { background: #0f0; color: black; }
        .btn-fame { background: purple; color: white; }
        .btn-reject { background: red; color: white; }
    </style>
</head>
<body>
    <div id="loginScreen" class="login-box">
        <h2 style="margin-bottom: 20px;">üîê –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨</h2>
        <input type="password" class="login-input" id="adminPassword" placeholder="–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∞" autocomplete="off">
        <button class="login-btn" onclick="checkAdminPassword()">–í–û–ô–¢–ò</button>
        <p id="loginError" style="color: red; margin-top: 15px; display: none;">–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!</p>
    </div>
    
    <div id="adminPanel" style="display: none;">
        <div class="header">
            <a href="index.html" class="back-btn">‚Üê</a>
            <h1>–ü–∞–Ω–µ–ª—å –º–æ–¥–µ—Ä–∞—Ü–∏–∏</h1>
        </div>
        
        <div id="pendingContainer">
            <div style="text-align: center; padding: 50px; color: #888;">
                –ó–∞–≥—Ä—É–∑–∫–∞...
            </div>
        </div>
    </div>

<script>
// üõ°Ô∏è –ó–ê–®–ò–§–†–û–í–ê–ù–ù–´–ï –ö–õ–Æ–ß–ò
const ENCODED = {
    a: "Njk1ODc5ZjJhZTU5NmU3MDhmYzEzZjU3",
    b: "JDJhJDEwJGxNM25IV2Y1b2hFM1RwZXlyek9QWGVMZ1gzd3V2blFDT1AyRHpKakNQdFlwQlh0cmFmN3dD",
    c: "MTIyMzMx"
};

// üîì –†–ê–°–®–ò–§–†–û–í–ö–ê
function getKeys() {
    try {
        return {
            BIN_ID: atob(ENCODED.a),
            MASTER_KEY: atob(ENCODED.b),
            ADMIN_PASS: atob(ENCODED.c)
        };
    } catch(e) {
        return {
            BIN_ID: "695879f2ae596e708fc13f57",
            MASTER_KEY: "$2a$10$lM3wHWf5ohE1cJ0K/tn07eVuj7W80ZljxdwJUaND/cBOQdKKxptVC",
            ADMIN_PASS: "122331"
        };
    }
}

const CONFIG = getKeys();
let currentVersion = null;

// üîê –ü–†–û–í–ï–†–ö–ê –ü–ê–†–û–õ–Ø –ê–î–ú–ò–ù–ê
function checkAdminPassword() {
    const input = document.getElementById('adminPassword').value;
    const errorElem = document.getElementById('loginError');
    
    if (input === CONFIG.ADMIN_PASS) {
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
        loadPendingPastes();
    } else {
        errorElem.style.display = 'block';
        document.getElementById('adminPassword').style.borderColor = 'red';
        document.getElementById('adminPassword').value = '';
    }
}

// üì• –ó–ê–ì–†–£–ó–ò–¢–¨ –ü–ê–°–¢–´ –ù–ê –ú–û–î–ï–†–ê–¶–ò–Æ
async function loadPendingPastes() {
    try {
        const response = await fetch(
            `https://api.jsonbin.io/v3/b/${CONFIG.BIN_ID}`,
            { 
                headers: { 
                    'X-Master-Key': CONFIG.MASTER_KEY,
                    'X-Bin-Versioning': 'false'
                } 
            }
        );
        
        if (!response.ok) {
            throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status}`);
        }
        
        const data = await response.json();
        const db = data.record;
        currentVersion = data.metadata.version;
        
        const pending = db.pastes.filter(p => p.status === 'pending');
        
        const container = document.getElementById('pendingContainer');
        if (pending.length === 0) {
            container.innerHTML = '<div style="text-align:center;padding:50px;color:#888">‚úÖ –ù–µ—Ç –ø–∞—Å—Ç –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</div>';
            return;
        }
        
        container.innerHTML = pending.map(p => `
            <div class="paste-card" id="paste-${p.id}">
                <div class="paste-lika">üîë ${escapeHtml(p.lika)}</div>
                <div style="color:#888;font-size:12px;margin-bottom:10px">
                    üë§ ${escapeHtml(p.author)} ‚Ä¢ üìÖ ${p.date}
                </div>
                
                <div class="paste-preview">
                    <strong>‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è:</strong><br>
                    ${escapeHtml(p.validation.substring(0, 150))}${p.validation.length > 150 ? '...' : ''}
                </div>
                
                <div class="paste-preview">
                    <strong>üìÑ –ü–∞—Å—Ç–∞:</strong><br>
                    ${escapeHtml(p.content.substring(0, 200))}${p.content.length > 200 ? '...' : ''}
                </div>
                
                <div class="controls">
                    <button class="control-btn btn-approve" onclick="approvePaste(${p.id}, false)">
                        ‚úÖ –û–¥–æ–±—Ä–∏—Ç—å
                    </button>
                    <button class="control-btn btn-fame" onclick="approvePaste(${p.id}, true)">
                        üî• #—Ñ–µ–π–º
                    </button>
                    <button class="control-btn btn-reject" onclick="rejectPaste(${p.id})">
                        ‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å
                    </button>
                </div>
            </div>
        `).join('');
        
    } catch (error) {
        document.getElementById('pendingContainer').innerHTML = 
            '<div style="text-align:center;padding:50px;color:red">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
        console.error('Load error:', error);
    }
}

// ‚úÖ –û–î–û–ë–†–ò–¢–¨ –ü–ê–°–¢–£
async function approvePaste(id, addFame) {
    if (!confirm(`–û–¥–æ–±—Ä–∏—Ç—å –ø–∞—Å—Ç—É #${id}${addFame ? ' —Å —Ç–µ–≥–æ–º #—Ñ–µ–π–º' : ''}?`)) return;
    
    try {
        const response = await fetch(
            `https://api.jsonbin.io/v3/b/${CONFIG.BIN_ID}`,
            { 
                headers: { 
                    'X-Master-Key': CONFIG.MASTER_KEY,
                    'X-Bin-Versioning': 'false'
                } 
            }
        );
        
        if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
        const data = await response.json();
        const db = data.record;
        
        if (data.metadata.version !== currentVersion) {
            alert('–ë–∞–∑–∞ –æ–±–Ω–æ–≤–∏–ª–∞—Å—å! –û–±–Ω–æ–≤–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
            return;
        }
        
        const paste = db.pastes.find(p => p.id === id);
        if (paste) {
            paste.status = 'approved';
            if (addFame) {
                paste.tag = '#—Ñ–µ–π–º';
            }
        }
        
        const saveResponse = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.BIN_ID}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'X-Master-Key': CONFIG.MASTER_KEY,
                'X-Bin-Versioning': 'false'
            },
            body: JSON.stringify(db)
        });
        
        if (saveResponse.ok) {
            document.getElementById(`paste-${id}`).remove();
            alert('‚úÖ –ü–∞—Å—Ç–∞ –æ–¥–æ–±—Ä–µ–Ω–∞!');
            currentVersion = (await saveResponse.json()).metadata.version;
        } else {
            throw new Error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
        }
    } catch (error) {
        console.error('Approve error:', error);
        alert('‚ùå –û—à–∏–±–∫–∞!');
    }
}

// ‚ùå –û–¢–ö–õ–û–ù–ò–¢–¨ –ü–ê–°–¢–£
async function rejectPaste(id) {
    if (!confirm(`–û—Ç–∫–ª–æ–Ω–∏—Ç—å –ø–∞—Å—Ç—É #${id}?`)) return;
    
    try {
        const response = await fetch(
            `https://api.jsonbin.io/v3/b/${CONFIG.BIN_ID}`,
            { 
                headers: { 
                    'X-Master-Key': CONFIG.MASTER_KEY,
                    'X-Bin-Versioning': 'false'
                } 
            }
        );
        
        if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
        const data = await response.json();
        const db = data.record;
        
        if (data.metadata.version !== currentVersion) {
            alert('–ë–∞–∑–∞ –æ–±–Ω–æ–≤–∏–ª–∞—Å—å! –û–±–Ω–æ–≤–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
            return;
        }
        
        const paste = db.pastes.find(p => p.id === id);
        if (paste) {
            paste.status = 'rejected';
        }
        
        const saveResponse = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.BIN_ID}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'X-Master-Key': CONFIG.MASTER_KEY,
                'X-Bin-Versioning': 'false'
            },
            body: JSON.stringify(db)
        });
        
        if (saveResponse.ok) {
            document.getElementById(`paste-${id}`).remove();
            alert('‚ùå –ü–∞—Å—Ç–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞!');
            currentVersion = (await saveResponse.json()).metadata.version;
        } else {
            throw new Error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
        }
    } catch (error) {
        console.error('Reject error:', error);
        alert('‚ùå –û—à–∏–±–∫–∞!');
    }
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// ‚å®Ô∏è –í–í–û–î –ü–û ENTER
document.getElementById('adminPassword').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') checkAdminPassword();
});
</script>
</body>
</html>