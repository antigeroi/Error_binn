<!DOCTYPE html>
<html>
<head>
    <title>–ú–æ–¥–µ—Ä–∞—Ü–∏—è</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body{background:#1a1a1a;color:white;font-family:Arial;padding:20px}
        .header{display:flex;align-items:center;margin-bottom:20px}
        .back-btn{color:white;text-decoration:none;font-size:20px;margin-right:10px}
        h1{color:red;margin:0}
        .paste-card{background:#2a2a2a;border-radius:8px;padding:15px;margin-bottom:10px;border-left:3px solid orange}
        .paste-lika{color:#0f0;font-weight:bold;margin-bottom:5px}
        .paste-preview{color:#ccc;font-size:13px;margin:10px 0}
        .actions{display:flex;gap:10px;margin-top:10px}
        .btn{flex:1;padding:8px;border:none;border-radius:5px;font-weight:bold}
        .approve{background:#0f0;color:black}
        .reject{background:red;color:white}
        .fame-check{margin-top:10px;color:#888;font-size:13px}
        .no-pastes{text-align:center;padding:50px;color:#888}
        .refresh-btn{background:#0088cc;color:white;padding:10px 20px;border:none;border-radius:5px;margin-bottom:20px}
    </style>
</head>
<body>
    <div class="header">
        <a href="index.html" class="back-btn">‚Üê</a>
        <h1>–ú–æ–¥–µ—Ä–∞—Ü–∏—è</h1>
    </div>

    <button class="refresh-btn" onclick="loadPendingPastes()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>

    <div id="pendingContainer">
        <div class="no-pastes">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <script>
        // –ù–ê–°–¢–†–û–ô–ö–ò JSONBIN
        const BIN_ID = '695858f1ae596e708fc0ffea';
        const MASTER_KEY = '$2a$10$ftDuSkomUMvmkGtIeeIAMebzWHBRhLWA.xaosW/.pc8G1ys2HPcxG';
        const JSONBIN_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;
        
        // –ü–ê–†–û–õ–¨ –ê–î–ú–ò–ù–ê
        const ADMIN_PASSWORD = '199221';
        
        // –ü–†–û–í–ï–†–ö–ê –ü–ê–†–û–õ–Ø
        const password = prompt('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:');
        if(password !== ADMIN_PASSWORD) {
            alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!');
            window.location.href = 'index.html';
        }
        
        // –ó–ê–ì–†–£–ó–ò–¢–¨ –ë–ê–ó–£
        async function loadDatabase() {
            try {
                const response = await fetch(JSONBIN_URL + '/latest', {
                    headers: { 'X-Master-Key': MASTER_KEY }
                });
                
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
                const data = await response.json();
                return { db: data.record, version: data.metadata.version };
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                return { db: { pastes: [], users: [] }, version: null };
            }
        }
        
        // –°–û–•–†–ê–ù–ò–¢–¨ –ë–ê–ó–£
        async function saveDatabase(db, version) {
            try {
                const response = await fetch(JSONBIN_URL, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': MASTER_KEY,
                        'X-Bin-Versioning': 'false'
                    },
                    body: JSON.stringify(db)
                });
                
                return response.ok;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                return false;
            }
        }
        
        // –ó–ê–ì–†–£–ó–ò–¢–¨ –ü–ê–°–¢–´ –ù–ê –ú–û–î–ï–†–ê–¶–ò–Æ
        async function loadPendingPastes() {
            const { db, version } = await loadDatabase();
            const pending = db.pastes.filter(p => p.status === 'pending');
            
            const container = document.getElementById('pendingContainer');
            if (!pending.length) {
                container.innerHTML = '<div class="no-pastes">–ù–µ—Ç –ø–∞—Å—Ç –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</div>';
                return { db, version };
            }
            
            container.innerHTML = pending.map(p => `
                <div class="paste-card" id="paste-${p.id}">
                    <div class="paste-lika">${escapeHtml(p.lika)}</div>
                    <div style="color:#888;font-size:12px">by ${escapeHtml(p.author)} ‚Ä¢ ${p.date}</div>
                    <div class="paste-preview">${escapeHtml(p.validation.substring(0, 120))}${p.validation.length > 120 ? '...' : ''}</div>
                    <div class="fame-check">
                        <input type="checkbox" id="fame-${p.id}"> –î–æ–±–∞–≤–∏—Ç—å #—Ñ–µ–π–º
                    </div>
                    <div class="actions">
                        <button class="btn approve" onclick="approvePaste(${p.id}, ${version})">–û–¥–æ–±—Ä–∏—Ç—å</button>
                        <button class="btn reject" onclick="rejectPaste(${p.id}, ${version})">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                    </div>
                </div>
            `).join('');
            
            return { db, version };
        }
        
        // –û–î–û–ë–†–ò–¢–¨ –ü–ê–°–¢–£
        async function approvePaste(id, oldVersion) {
            const { db, version } = await loadDatabase();
            
            // –ü–†–û–í–ï–†–ö–ê –í–ï–†–°–ò–ò (—á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å —á—É–∂–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)
            if (version !== oldVersion) {
                alert('–ë–∞–∑–∞ –æ–±–Ω–æ–≤–∏–ª–∞—Å—å! –û–±–Ω–æ–≤–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
                return;
            }
            
            const paste = db.pastes.find(p => p.id === id);
            if (paste) {
                paste.status = 'approved';
                if (document.getElementById(`fame-${id}`).checked) {
                    paste.tag = '#—Ñ–µ–π–º';
                }
                
                const success = await saveDatabase(db, version);
                if (success) {
                    alert('–ü–∞—Å—Ç–∞ –æ–¥–æ–±—Ä–µ–Ω–∞!');
                    await loadPendingPastes();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏!');
                }
            }
        }
        
        // –û–¢–ö–õ–û–ù–ò–¢–¨ –ü–ê–°–¢–£
        async function rejectPaste(id, oldVersion) {
            const { db, version } = await loadDatabase();
            
            if (version !== oldVersion) {
                alert('–ë–∞–∑–∞ –æ–±–Ω–æ–≤–∏–ª–∞—Å—å! –û–±–Ω–æ–≤–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
                return;
            }
            
            const paste = db.pastes.find(p => p.id === id);
            if (paste) {
                paste.status = 'rejected';
                
                const success = await saveDatabase(db, version);
                if (success) {
                    alert('–ü–∞—Å—Ç–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞!');
                    await loadPendingPastes();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏!');
                }
            }
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // –ó–ê–ü–£–°–ö
        loadPendingPastes();
    </script>
</body>
</html>