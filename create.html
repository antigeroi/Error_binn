<!DOCTYPE html>
<html>
<head>
    <title>–°–æ–∑–¥–∞—Ç—å –ø–∞—Å—Ç—É üîí</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body{background:#111;color:#fff;font-family:'Segoe UI',Arial,sans-serif;margin:0;min-height:100vh}
        .header{background:linear-gradient(135deg,#1a1a1a,#222);padding:15px;border-bottom:2px solid #ff4444;display:flex;align-items:center;position:sticky;top:0;z-index:1000}
        .back-btn{color:#fff;text-decoration:none;font-size:28px;margin-right:15px;transition:all 0.3s}
        .back-btn:hover{color:#ff4444;transform:scale(1.2)}
        h1{color:#ff4444;margin:0;font-size:22px;font-weight:bold}
        .form-container{max-width:600px;margin:30px auto;padding:0 20px}
        .form-group{margin-bottom:25px}
        label{display:block;color:#aaa;margin-bottom:8px;font-weight:bold;font-size:14px}
        input,textarea{width:100%;padding:15px;background:#222;border:1px solid #444;border-radius:10px;color:#fff;font-size:16px;font-family:'Segoe UI',Arial;transition:all 0.3s;box-sizing:border-box}
        input:focus,textarea:focus{outline:none;border-color:#44ff44;box-shadow:0 0 10px rgba(68,255,68,0.3)}
        textarea{min-height:150px;resize:vertical}
        .btn-group{display:flex;gap:15px;margin-top:30px}
        .btn{flex:1;padding:16px;border:none;border-radius:10px;font-weight:bold;font-size:16px;cursor:pointer;transition:all 0.3s}
        .btn-submit{background:linear-gradient(135deg,#44ff44,#22aa22);color:#000;box-shadow:0 4px 10px rgba(68,255,68,0.3)}
        .btn-submit:hover{background:linear-gradient(135deg,#55ff55,#33bb33);transform:translateY(-2px);box-shadow:0 6px 15px rgba(68,255,68,0.4)}
        .btn-cancel{background:transparent;border:2px solid #666;color:#aaa}
        .btn-cancel:hover{background:#222;border-color:#888;color:#fff}
        .message{background:#ff4444;color:white;padding:15px;border-radius:10px;margin-bottom:20px;display:none;text-align:center;font-weight:bold}
        .message.success{background:linear-gradient(135deg,#44ff44,#22aa22);color:#000}
        .char-count{text-align:right;color:#888;font-size:12px;margin-top:5px}
        .char-count.warning{color:#ffaa44}
        .char-count.error{color:#ff4444}
        
        /* –ó–ê–©–ò–¢–ù–´–ô –≠–ö–†–ê–ù */
        .shield-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:#111;z-index:9999;display:flex;justify-content:center;align-items:center}
        .shield-box{background:#222;padding:40px;border-radius:15px;text-align:center;border:2px solid #ff4444;max-width:400px;width:90%}
        .shield-input{padding:15px;width:100%;margin:20px 0;background:#333;border:1px solid #444;border-radius:8px;color:#fff;font-size:16px;text-align:center}
        .shield-btn{padding:12px 30px;background:#ff4444;color:white;border:none;border-radius:8px;font-weight:bold;cursor:pointer;transition:all 0.3s}
        .shield-btn:hover{background:#ff2222;transform:scale(1.05)}
        .shield-error{color:#ff4444;margin-top:15px;display:none}
    </style>
</head>
<body>
    <!-- –ó–ê–©–ò–¢–ù–´–ô –≠–ö–†–ê–ù -->
    <div class="shield-screen" id="shieldScreen">
        <div class="shield-box">
            <h2 style="color:#ff4444;margin-bottom:10px">üîí –î–û–°–¢–£–ü –ö –°–û–ó–î–ê–ù–ò–Æ</h2>
            <p style="color:#aaa;margin-bottom:20px">–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–∞—Å—Ç—ã</p>
            <input type="password" class="shield-input" id="shieldPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="off">
            <button class="shield-btn" onclick="checkShieldPassword()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
            <p id="shieldError" class="shield-error">–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!</p>
        </div>
    </div>

    <!-- –û–°–ù–û–í–ù–û–ô –ò–ù–¢–ï–†–§–ï–ô–° -->
    <div class="header">
        <a href="index.html" class="back-btn">‚Üê</a>
        <h1>–°–æ–∑–¥–∞—Ç—å –ø–∞—Å—Ç—É</h1>
    </div>

    <div class="form-container">
        <div class="message" id="message"></div>

        <div class="form-group">
            <label>üîë –õ–ò–ö–ê:</label>
            <input type="text" id="lika" placeholder="–ö—Ç–æ —Å–¥–µ–ª–∞–ª" maxlength="100" autocomplete="off">
            <div class="char-count" id="likaCount">0/100</div>
        </div>

        <div class="form-group">
            <label>‚úÖ –í–ê–õ–ò–î–ê–¶–ò–Ø:</label>
            <textarea id="validation" placeholder="–¶–µ–ø–æ—á–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏" maxlength="500"></textarea>
            <div class="char-count" id="validationCount">0/500</div>
        </div>

        <div class="form-group">
            <label>üìÑ –ü–ê–°–¢–ê:</label>
            <textarea id="content" placeholder="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"></textarea>
            <div class="char-count" id="contentCount">0/2000</div>
        </div>

        <div class="btn-group">
            <button class="btn btn-submit" onclick="submitPaste()">‚úÖ –°–æ–∑–¥–∞—Ç—å –ø–∞—Å—Ç—É</button>
            <button class="btn btn-cancel" onclick="goBack()">‚ùå –û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <script>
        // üîê –°–ò–°–¢–ï–ú–ê –ó–ê–©–ò–¢–´ CREATE.HTML
        
        // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
        const SECURITY_CONFIG = {
            ACCESS_PASSWORD: '188221',
            ENCRYPTED_KEYS: {
                binId: 'Njk1ODY5MzlhZTU5NmU3MDhmYzEyNGI3',
                masterKey: 'JDJhJDEwJGwxNWJHczVjSlVpSW1ZRVcwUzhwSnVIUmxrT2hvNTMuZ2FNOGt4NUNOSWFE" + "MHdnWTIyRFo2'
            },
            MAX_ATTEMPTS: 3
        };
        
        let securityToken = null;
        let failedAttempts = 0;
        let keys = null;
        let JSONBIN_URL = null;
        
        // üîê –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ó–ê–©–ò–¢–´
        function initializeSecurity() {
            console.log('üõ°Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–æ–∑–¥–∞–Ω–∏—é...');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –∏–∑ index.html
            const sessionToken = localStorage.getItem('create_token');
            const mainSession = localStorage.getItem('secure_session');
            
            if (sessionToken && mainSession) {
                try {
                    const session = JSON.parse(mainSession);
                    if (session.token === sessionToken && session.expiry > Date.now()) {
                        securityToken = sessionToken;
                        document.getElementById('shieldScreen').style.display = 'none';
                        initializeForm();
                        return;
                    }
                } catch(e) {
                    localStorage.removeItem('create_token');
                }
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –∑–∞—â–∏—Ç—ã
            document.getElementById('shieldScreen').style.display = 'flex';
            document.getElementById('shieldPassword').focus();
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter
            document.getElementById('shieldPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') checkShieldPassword();
            });
        }
        
        // üîê –ü–†–û–í–ï–†–ö–ê –ü–ê–†–û–õ–Ø
        function checkShieldPassword() {
            const input = document.getElementById('shieldPassword').value.trim();
            const errorElem = document.getElementById('shieldError');
            
            if (input !== SECURITY_CONFIG.ACCESS_PASSWORD) {
                failedAttempts++;
                errorElem.style.display = 'block';
                errorElem.textContent = `–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å! (${failedAttempts}/${SECURITY_CONFIG.MAX_ATTEMPTS})`;
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –æ—à–∏–±–∫–∏
                document.getElementById('shieldPassword').style.borderColor = '#ff4444';
                document.getElementById('shieldPassword').style.animation = 'shake 0.5s';
                setTimeout(() => {
                    document.getElementById('shieldPassword').style.animation = '';
                    document.getElementById('shieldPassword').value = '';
                }, 500);
                
                if (failedAttempts >= SECURITY_CONFIG.MAX_ATTEMPTS) {
                    setTimeout(() => window.location.href = 'index.html', 2000);
                }
                return;
            }
            
            // –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥
            securityToken = generateToken();
            document.getElementById('shieldScreen').style.display = 'none';
            showMessage('‚úÖ –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω', 'success');
            initializeForm();
        }
        
        // üîê –ì–ï–ù–ï–†–ê–¶–ò–Ø –¢–û–ö–ï–ù–ê
        function generateToken() {
            return btoa(Date.now() + '|' + Math.random().toString(36)).substring(0, 32);
        }
        
        // üîê –ü–û–õ–£–ß–ï–ù–ò–ï –ö–õ–Æ–ß–ï–ô
        function getSecureKeys() {
            try {
                const binId = atob(SECURITY_CONFIG.ENCRYPTED_KEYS.binId);
                const masterKey = atob(SECURITY_CONFIG.ENCRYPTED_KEYS.masterKey);
                
                if (!binId || !masterKey) throw new Error('Invalid keys');
                return { BIN_ID: binId, MASTER_KEY: masterKey };
            } catch (e) {
                console.error('Key error:', e);
                showMessage('‚ùå –û—à–∏–±–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏', 'error');
                return null;
            }
        }
        
        // üîê –ë–ï–ó–û–ü–ê–°–ù–´–ô FETCH
        async function secureFetch(url, options = {}) {
            if (!securityToken) throw new Error('No security token');
            
            if (!options.headers) options.headers = {};
            options.headers['X-Security-Token'] = securityToken;
            
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 10000);
            options.signal = controller.signal;
            
            try {
                const response = await fetch(url, options);
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    if (response.status === 401 || response.status === 403) {
                        showMessage('üîê –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è', 'error');
                        setTimeout(() => window.location.href = 'index.html', 2000);
                    }
                    throw new Error(`HTTP ${response.status}`);
                }
                
                return response;
            } catch (error) {
                clearTimeout(timeoutId);
                throw error;
            }
        }
        
        // üìù –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –§–û–†–ú–´
        function initializeForm() {
            console.log('üìù –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è...');
            
            // –ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á–∏
            keys = getSecureKeys();
            if (!keys) return;
            
            JSONBIN_URL = `https://api.jsonbin.io/v3/b/${keys.BIN_ID}`;
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—á–µ—Ç—á–∏–∫–æ–≤ —Å–∏–º–≤–æ–ª–æ–≤
            setupCharCounters();
            
            // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–Ω–æ–≤–∏–∫–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(autoSaveDraft, 30000);
            
            // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫
            restoreDraft();
            
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –∑–∞–∫—Ä—ã—Ç–∏–µ —Å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
            window.addEventListener('beforeunload', (e) => {
                if (hasUnsavedChanges()) {
                    e.preventDefault();
                    e.returnValue = '–£ –≤–∞—Å –µ—Å—Ç—å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è. –£–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–π—Ç–∏?';
                }
            });
        }
        
        // üìù –ù–ê–°–¢–†–û–ô–ö–ê –°–ß–ï–¢–ß–ò–ö–û–í –°–ò–ú–í–û–õ–û–í
        function setupCharCounters() {
            const fields = ['lika', 'validation', 'content'];
            const limits = { lika: 100, validation: 500, content: 2000 };
            
            fields.forEach(field => {
                const input = document.getElementById(field);
                const counter = document.getElementById(field + 'Count');
                
                input.addEventListener('input', () => {
                    const length = input.value.length;
                    const limit = limits[field];
                    const percent = (length / limit) * 100;
                    
                    counter.textContent = `${length}/${limit}`;
                    counter.className = 'char-count';
                    
                    if (percent > 90) {
                        counter.classList.add('warning');
                    }
                    if (percent > 100) {
                        counter.classList.add('error');
                        input.value = input.value.substring(0, limit);
                        counter.textContent = `${limit}/${limit}`;
                    }
                    
                    saveDraft();
                });
            });
        }
        
        // üíæ –ê–í–¢–û–°–û–•–†–ê–ù–ï–ù–ò–ï –ß–ï–†–ù–û–í–ò–ö–ê
        function autoSaveDraft() {
            if (hasUnsavedChanges()) {
                saveDraft();
                console.log('üíæ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–Ω–æ–≤–∏–∫–∞');
            }
        }
        
        // üíæ –°–û–•–†–ê–ù–ò–¢–¨ –ß–ï–†–ù–û–í–ò–ö
        function saveDraft() {
            const draft = {
                lika: document.getElementById('lika').value,
                validation: document.getElementById('validation').value,
                content: document.getElementById('content').value,
                timestamp: Date.now()
            };
            
            localStorage.setItem('paste_draft', JSON.stringify(draft));
        }
        
        // üíæ –í–û–°–°–¢–ê–ù–û–í–ò–¢–¨ –ß–ï–†–ù–û–í–ò–ö
        function restoreDraft() {
            try {
                const draft = JSON.parse(localStorage.getItem('paste_draft'));
                if (draft && Date.now() - draft.timestamp < 86400000) { // 24 —á–∞—Å–∞
                    document.getElementById('lika').value = draft.lika || '';
                    document.getElementById('validation').value = draft.validation || '';
                    document.getElementById('content').value = draft.content || '';
                    
                    // –û–±–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫–∏
                    ['lika', 'validation', 'content'].forEach(field => {
                        const input = document.getElementById(field);
                        const counter = document.getElementById(field + 'Count');
                        counter.textContent = `${input.value.length}/${field === 'lika' ? 100 : field === 'validation' ? 500 : 2000}`;
                    });
                    
                    showMessage('üìã –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —á–µ—Ä–Ω–æ–≤–∏–∫', 'success');
                    setTimeout(() => hideMessage(), 2000);
                }
            } catch (e) {
                // ignore
            }
        }
        
        // üîç –ü–†–û–í–ï–†–ö–ê –ò–ó–ú–ï–ù–ï–ù–ò–ô
        function hasUnsavedChanges() {
            return document.getElementById('lika').value.trim() !== '' ||
                   document.getElementById('validation').value.trim() !== '' ||
                   document.getElementById('content').value.trim() !== '';
        }
        
        // üì® –û–¢–ü–†–ê–í–ò–¢–¨ –ü–ê–°–¢–£
        async function submitPaste() {
            const lika = document.getElementById('lika').value.trim();
            const validation = document.getElementById('validation').value.trim();
            const content = document.getElementById('content').value.trim();
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!lika) {
                showMessage('‚ùå –í–≤–µ–¥–∏—Ç–µ –ª–∏–∫—É!', 'error');
                document.getElementById('lika').focus();
                return;
            }
            if (!validation) {
                showMessage('‚ùå –í–≤–µ–¥–∏—Ç–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é!', 'error');
                document.getElementById('validation').focus();
                return;
            }
            if (!content) {
                showMessage('‚ùå –í–≤–µ–¥–∏—Ç–µ –ø–∞—Å—Ç—É!', 'error');
                document.getElementById('content').focus();
                return;
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
            const originalText = document.querySelector('.btn-submit').textContent;
            document.querySelector('.btn-submit').textContent = 'üîÑ –û—Ç–ø—Ä–∞–≤–∫–∞...';
            document.querySelector('.btn-submit').disabled = true;
            
            try {
                // –ó–∞–≥—Ä—É–∑–∏—Ç—å –±–∞–∑—É
                const response = await secureFetch(JSONBIN_URL + '/latest', {
                    headers: { 'X-Master-Key': keys.MASTER_KEY }
                });
                
                const data = await response.json();
                const db = data.record;
                const version = data.metadata.version;
                
                // –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Å—Ç—É
                db.pastes.push({
                    id: Date.now(),
                    lika: lika,
                    validation: validation,
                    content: content,
                    author: 'user_' + Math.random().toString(36).substr(2, 8),
                    status: 'pending',
                    tag: '',
                    date: new Date().toLocaleString('ru-RU')
                });
                
                // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –±–∞–∑—É
                const saveResponse = await secureFetch(JSONBIN_URL, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': keys.MASTER_KEY,
                        'X-Bin-Versioning': 'false'
                    },
                    body: JSON.stringify(db)
                });
                
                if (saveResponse.ok) {
                    // –û—á–∏—Å—Ç–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫
                    localStorage.removeItem('paste_draft');
                    
                    // –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É
                    document.getElementById('lika').value = '';
                    document.getElementById('validation').value = '';
                    document.getElementById('content').value = '';
                    
                    // –û–±–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫–∏
                    ['lika', 'validation', 'content'].forEach(field => {
                        document.getElementById(field + 'Count').textContent = '0/' + 
                            (field === 'lika' ? 100 : field === 'validation' ? 500 : 2000);
                    });
                    
                    showMessage('‚úÖ –ü–∞—Å—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é!', 'success');
                    
                    // –í–µ—Ä–Ω—É—Ç—å—Å—è —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 2000);
                    
                } else {
                    throw new Error('Save failed');
                }
                
            } catch (error) {
                console.error('Submit error:', error);
                showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ: ' + error.message, 'error');
                
                // –í–∫–ª—é—á–∏—Ç—å –∫–Ω–æ–ø–∫—É
                document.querySelector('.btn-submit').textContent = originalText;
                document.querySelector('.btn-submit').disabled = false;
            }
        }
        
        // üí¨ –ü–û–ö–ê–ó–ê–¢–¨ –°–û–û–ë–©–ï–ù–ò–ï
        function showMessage(text, type = 'error') {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = 'message ' + (type === 'success' ? 'success' : '');
            msg.style.display = 'block';
            
            if (type === 'success') {
                setTimeout(hideMessage, 3000);
            }
        }
        
        // üí¨ –°–ö–†–´–¢–¨ –°–û–û–ë–©–ï–ù–ò–ï
        function hideMessage() {
            document.getElementById('message').style.display = 'none';
        }
        
        // ‚Ü©Ô∏è –í–ï–†–ù–£–¢–¨–°–Ø –ù–ê–ó–ê–î
        function goBack() {
            if (hasUnsavedChanges()) {
                if (confirm('–£ –≤–∞—Å –µ—Å—Ç—å –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è. –£–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–π—Ç–∏?')) {
                    window.location.href = 'index.html';
                }
            } else {
                window.location.href = 'index.html';
            }
        }
        
        // üé® –°–¢–ò–õ–ò –î–õ–Ø –ê–ù–ò–ú–ê–¶–ò–ô
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
                20%, 40%, 60%, 80% { transform: translateX(5px); }
            }
        `;
        document.head.appendChild(style);
        
        // üöÄ –ó–ê–ü–£–°–ö
        initializeSecurity();
        
    </script>
</body>
</html>