<!DOCTYPE html>
<html>
<head>
    <title>–°–æ–∑–¥–∞—Ç—å –ø–∞—Å—Ç—É</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { background: #111; color: #fff; font-family: Arial; padding: 20px; }
        .header { display: flex; align-items: center; margin-bottom: 30px; }
        .back-btn { color: white; font-size: 30px; margin-right: 15px; text-decoration: none; }
        h1 { color: red; margin: 0; }
        .form-group { margin-bottom: 20px; }
        input, textarea { width: 100%; padding: 15px; background: #222; border: 1px solid #444; color: white; border-radius: 8px; }
        textarea { min-height: 100px; resize: vertical; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 8px; font-weight: bold; margin-top: 10px; }
        .btn-submit { background: #0f0; color: black; }
        .btn-cancel { background: #333; color: white; }
        .message { background: red; color: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: none; }
        .message.success { background: #0f0; color: black; }
        .char-count { text-align: right; color: #888; font-size: 12px; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="header">
        <a href="index.html" class="back-btn">‚Üê</a>
        <h1>–°–æ–∑–¥–∞—Ç—å –ø–∞—Å—Ç—É</h1>
    </div>

    <div class="message" id="message"></div>

    <div class="form-group">
        <input type="text" id="lika" placeholder="üîë –õ–ò–ö–ê" maxlength="100" autocomplete="off">
        <div class="char-count" id="likaCount">0/100</div>
    </div>

    <div class="form-group">
        <textarea id="validation" placeholder="‚úÖ –í–ê–õ–ò–î–ê–¶–ò–Ø" maxlength="500"></textarea>
        <div class="char-count" id="validationCount">0/500</div>
    </div>

    <div class="form-group">
        <textarea id="content" placeholder="üìÑ –ü–ê–°–¢–ê"></textarea>
        <div class="char-count" id="contentCount">0/2000</div>
    </div>

    <button class="btn btn-submit" onclick="submitPaste()">‚úÖ –û–¢–ü–†–ê–í–ò–¢–¨</button>
    <button class="btn btn-cancel" onclick="window.location='index.html'">‚ùå –û–¢–ú–ï–ù–ê</button>

<script>
    // üîê –ó–ê–®–ò–§–†–û–í–ê–ù–ù–´–ï –ö–õ–Æ–ß–ò (Base64 + —Å–¥–≤–∏–≥)
    const ENCRYPTED_BIN_ID = 'Njk1OTFmNGZkMGVhODgxZjQwNTFiYjJj';
    const ENCRYPTED_MASTER_KEY = 'JDJhJDEwJGcwVGR4ZFNZVy9IaDlUVWcyRzRoWmV0cGl5Y3pTSFdXSkN5WHF3Yzh5bENZLms1cFVzbVUy';
    const ENCRYPTED_ADMIN_PASS = 'MTIyMzMx';
    
    // üîì –§–£–ù–ö–¶–ò–Ø –î–ï–®–ò–§–†–û–í–ö–ò
    function decryptData(encrypted) {
        try {
            let decoded = atob(encrypted);
            let result = '';
            for (let i = 0; i < decoded.length; i++) {
                result += String.fromCharCode(decoded.charCodeAt(i) - 3);
            }
            return result;
        } catch (e) {
            console.error('Decryption error:', e);
            return '';
        }
    }
    
    // üì¶ –ü–û–õ–£–ß–ò–¢–¨ –ö–õ–Æ–ß–ò
    function getConfig() {
        return {
            BIN_ID: decryptData(ENCRYPTED_BIN_ID),
            MASTER_KEY: decryptData(ENCRYPTED_MASTER_KEY),
            ADMIN_PASS: decryptData(ENCRYPTED_ADMIN_PASS)
        };
    }
    
    const config = getConfig();
    const JSONBIN_URL = `https://api.jsonbin.io/v3/b/${config.BIN_ID}`;
    
    // üìù –ù–ê–°–¢–†–û–ô–ö–ê –°–ß–ï–¢–ß–ò–ö–û–í
    function setupCharCounters() {
        const fields = [
            { id: 'lika', max: 100 },
            { id: 'validation', max: 500 },
            { id: 'content', max: 2000 }
        ];
        
        fields.forEach(field => {
            const input = document.getElementById(field.id);
            const counter = document.getElementById(field.id + 'Count');
            
            input.addEventListener('input', () => {
                const length = input.value.length;
                counter.textContent = `${length}/${field.max}`;
                
                if (length > field.max) {
                    input.value = input.value.substring(0, field.max);
                    counter.textContent = `${field.max}/${field.max}`;
                }
            });
        });
    }

    // –ó–ê–ì–†–£–ó–ò–¢–¨ –ë–ê–ó–£
    async function loadDatabase() {
        try {
            const response = await fetch(JSONBIN_URL + '/latest', {
                headers: { 'X-Master-Key': config.MASTER_KEY }
            });
            
            if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
            const data = await response.json();
            return data.record;
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞:', error);
            return { pastes: [], users: [] };
        }
    }

    // üì® –û–¢–ü–†–ê–í–ò–¢–¨ –ü–ê–°–¢–£
    async function submitPaste() {
        const lika = document.getElementById('lika').value.trim();
        const validation = document.getElementById('validation').value.trim();
        const content = document.getElementById('content').value.trim();
        
        if (!lika || !validation || !content) {
            showMessage('‚ùå –ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è!');
            return;
        }
        
        const btn = document.querySelector('.btn-submit');
        const originalText = btn.textContent;
        btn.textContent = 'üîÑ –û—Ç–ø—Ä–∞–≤–∫–∞...';
        btn.disabled = true;
        
        try {
            const db = await loadDatabase();
            
            db.pastes.push({
                id: Date.now(),
                lika: lika,
                validation: validation,
                content: content,
                author: 'user_' + Math.random().toString(36).slice(2, 10),
                status: 'pending',
                tag: '',
                date: new Date().toLocaleString('ru-RU')
            });
            
            const saveResponse = await fetch(JSONBIN_URL, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Master-Key': config.MASTER_KEY,
                    'X-Bin-Versioning': 'false'
                },
                body: JSON.stringify(db)
            });
            
            if (saveResponse.ok) {
                showMessage('‚úÖ –ü–∞—Å—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é!', 'success');
                
                document.getElementById('lika').value = '';
                document.getElementById('validation').value = '';
                document.getElementById('content').value = '';
                document.getElementById('likaCount').textContent = '0/100';
                document.getElementById('validationCount').textContent = '0/500';
                document.getElementById('contentCount').textContent = '0/2000';
                
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
            } else {
                throw new Error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
            }
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞:', error);
            showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ');
            btn.textContent = originalText;
            btn.disabled = false;
        }
    }

    // üí¨ –°–û–û–ë–©–ï–ù–ò–ï
    function showMessage(text, type = 'error') {
        const msg = document.getElementById('message');
        msg.textContent = text;
        msg.className = 'message' + (type === 'success' ? ' success' : '');
        msg.style.display = 'block';
        
        if (type === 'success') {
            setTimeout(() => msg.style.display = 'none', 3000);
        }
    }

    // üöÄ –ó–ê–ü–£–°–ö
    setupCharCounters();
</script>
</body>
</html>