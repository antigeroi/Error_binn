<!DOCTYPE html>
<html>
<head>
    <title>–°–æ–∑–¥–∞—Ç—å –ø–∞—Å—Ç—É</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { background: #111; color: #fff; font-family: Arial; padding: 20px; }
        .header { display: flex; align-items: center; margin-bottom: 30px; }
        .back-btn { color: white; font-size: 30px; margin-right: 15px; text-decoration: none; }
        h1 { color: red; margin: 0; }
        .form-group { margin-bottom: 20px; }
        input, textarea { width: 100%; padding: 15px; background: #222; border: 1px solid #444; color: white; border-radius: 8px; }
        textarea { min-height: 100px; resize: vertical; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 8px; font-weight: bold; margin-top: 10px; }
        .btn-submit { background: #0f0; color: black; }
        .btn-cancel { background: #333; color: white; }
        .message { background: red; color: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: none; }
        .message.success { background: #0f0; color: black; }
        .char-count { text-align: right; color: #888; font-size: 12px; margin-top: 5px; }
    </style>
</head>
<body>
    <!-- –ó–ê–ì–†–£–ó–ö–ê –¢–í–û–ï–ì–û config.js -->
    <script src="config.js"></script>
    
    <div class="header">
        <a href="index.html" class="back-btn">‚Üê</a>
        <h1>–°–æ–∑–¥–∞—Ç—å –ø–∞—Å—Ç—É</h1>
    </div>

    <div class="message" id="message"></div>

    <div class="form-group">
        <input type="text" id="lika" placeholder="üîë –õ–ò–ö–ê" maxlength="100" autocomplete="off">
        <div class="char-count" id="likaCount">0/100</div>
    </div>

    <div class="form-group">
        <textarea id="validation" placeholder="‚úÖ –í–ê–õ–ò–î–ê–¶–ò–Ø" maxlength="500"></textarea>
        <div class="char-count" id="validationCount">0/500</div>
    </div>

    <div class="form-group">
        <textarea id="content" placeholder="üìÑ –ü–ê–°–¢–ê"></textarea>
        <div class="char-count" id="contentCount">0/2000</div>
    </div>

    <button class="btn btn-submit" onclick="submitPaste()">‚úÖ –û–¢–ü–†–ê–í–ò–¢–¨</button>
    <button class="btn btn-cancel" onclick="window.location='index.html'">‚ùå –û–¢–ú–ï–ù–ê</button>

    <script>
        // üì¶ –ü–†–û–í–ï–†–ö–ê –ö–û–ù–§–ò–ì–ê
        if (!window.ERRORBIN_CONFIG) {
            document.body.innerHTML = '<h1 style="color:red;text-align:center;margin-top:50px">‚ùå –ó–∞–≥—Ä—É–∑–∏ config.js —Å –∫–ª—é—á–∞–º–∏!</h1>';
            throw new Error('Config not loaded');
        }
        
        const CONFIG = window.ERRORBIN_CONFIG;
        
        // üìù –ù–ê–°–¢–†–û–ô–ö–ê –°–ß–ï–¢–ß–ò–ö–û–í –°–ò–ú–í–û–õ–û–í
        function setupCharCounters() {
            const fields = [
                { id: 'lika', max: 100 },
                { id: 'validation', max: 500 },
                { id: 'content', max: 2000 }
            ];
            
            fields.forEach(field => {
                const input = document.getElementById(field.id);
                const counter = document.getElementById(field.id + 'Count');
                
                input.addEventListener('input', () => {
                    const length = input.value.length;
                    counter.textContent = `${length}/${field.max}`;
                    
                    if (length > field.max) {
                        input.value = input.value.substring(0, field.max);
                        counter.textContent = `${field.max}/${field.max}`;
                    }
                });
            });
        }
        
        // üì® –û–¢–ü–†–ê–í–ò–¢–¨ –ü–ê–°–¢–£
        async function submitPaste() {
            const lika = document.getElementById('lika').value.trim();
            const validation = document.getElementById('validation').value.trim();
            const content = document.getElementById('content').value.trim();
            
            if (!lika || !validation || !content) {
                showMessage('‚ùå –ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
            const btn = document.querySelector('.btn-submit');
            const originalText = btn.textContent;
            btn.textContent = 'üîÑ –û—Ç–ø—Ä–∞–≤–∫–∞...';
            btn.disabled = true;
            
            try {
                // 1. –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â—É—é –±–∞–∑—É
                const response = await fetch(
                    `https://api.jsonbin.io/v3/b/${CONFIG.BIN_ID}/latest`,
                    { headers: { 'X-Master-Key': CONFIG.MASTER_KEY } }
                );
                
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
                const data = await response.json();
                const db = data.record;
                
                // 2. –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –ø–∞—Å—Ç—É
                db.pastes.push({
                    id: Date.now(),
                    lika: lika,
                    validation: validation,
                    content: content,
                    author: 'user_' + Math.random().toString(36).substr(2, 8),
                    status: 'pending',
                    tag: '',
                    date: new Date().toLocaleString('ru-RU')
                });
                
                // 3. –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±—Ä–∞—Ç–Ω–æ
                const saveResponse = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.BIN_ID}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': CONFIG.MASTER_KEY,
                        'X-Bin-Versioning': 'false'
                    },
                    body: JSON.stringify(db)
                });
                
                if (saveResponse.ok) {
                    showMessage('‚úÖ –ü–∞—Å—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é!', 'success');
                    
                    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                    ['lika', 'validation', 'content'].forEach(id => {
                        document.getElementById(id).value = '';
                        document.getElementById(id + 'Count').textContent = '0/' + 
                            (id === 'lika' ? 100 : id === 'validation' ? 500 : 2000);
                    });
                    
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 2000);
                } else {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ');
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                btn.textContent = originalText;
                btn.disabled = false;
            }
        }
        
        // üí¨ –°–û–û–ë–©–ï–ù–ò–ï
        function showMessage(text, type = 'error') {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = 'message' + (type === 'success' ? ' success' : '');
            msg.style.display = 'block';
            
            if (type === 'success') {
                setTimeout(() => msg.style.display = 'none', 3000);
            }
        }
        
        // üöÄ –ó–ê–ü–£–°–ö
        setupCharCounters();
    </script>
</body>
</html>